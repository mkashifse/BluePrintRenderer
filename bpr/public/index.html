<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>BluePrintRenderer</title>

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
        }

        body {
            overflow: hidden;
        }
    </style>
</head>
<!-- <script src="./dist/main.js"></script> -->
<script src="https://cdn.rawgit.com/strelok2012/BluePrintRenderer/f0ebd3b179e0b829c943961442f524e663ef2b9a/dist/main.js"></script>
<script>

</script>

<body>

    <main>
        <select></select>
        <input type="file" id="upload" />
    </main>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-app.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.3/firebase-analytics.js"></script>

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyDGzrypBPF6vfA99EC78BNlGBS28aoLlvo",
            authDomain: "bp-renderer.firebaseapp.com",
            databaseURL: "https://bp-renderer.firebaseio.com",
            projectId: "bp-renderer",
            storageBucket: "bp-renderer.appspot.com",
            messagingSenderId: "754234979597",
            appId: "1:754234979597:web:b77b2fe5e086e73aaf2c44",
            measurementId: "G-MQRD774GX3"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
        const storage = firebase.storage();
        const db = firebase.firestore();
        let selectedUrl = null;

        const selectBox = document.querySelector('select');
        selectBox.onchange = (event) => {
            selectedUrl = event.target.value;
            const canvas = document.querySelector('canvas');
            const body = document.querySelector('body');
            body.removeChild(canvas);
            prepare(document, selectedUrl);
        }

        db.collection('files').onSnapshot(resp => {
            const files = resp.docs.map((item) => item.data());
            selectBox.innerHTML = files.map((item) => `<option value="${item.url}">${item.name}</option>`)
        })

        document.querySelector("#upload").onchange = (event) => {
            const file = event.target.files[0];
            console.log(file);
            const ref = storage.ref(file.name).put(file);
            ref.on(`state_changed`, null, null, () => {
                ref.snapshot.ref.getDownloadURL().then((url) => {
                    db.collection('files').add({
                        name: file.name,
                        url
                    }).then((resp) => {
                    })
                })
            })

        }
        const url = "tests/file.txt";
        document.addEventListener('DOMContentLoaded', function () {
            prepare(document, url);
        });
    </script>

</body>

</html>